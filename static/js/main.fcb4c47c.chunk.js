(this.webpackJsonpfire_alarm=this.webpackJsonpfire_alarm||[]).push([[0],{102:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(55),i=n.n(r),s=(n(66),n(14)),o=(n(67),n(1));function u(){return Object(o.jsx)("div",{className:"footer",children:Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("p",{children:"@TH CNTT 3"})})})}function l(){return Object(o.jsx)("div",{className:"header",children:Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("h2",{children:"Hotel Management"})})})}var f,d,j,b=n(23),h=n(5),m=n(10),g=n.n(m),v=n(16),O=n(8),x="https://it3-fire-api.herokuapp.com",p={fetchItems:function(){var e=Object(v.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(x,"/room")).then((function(e){return e.json()})).then((function(e){return e.payload})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fetchItemById:function(){var e=Object(v.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(x,"/room/get-by-id/").concat(t)).then((function(e){return e.json()})).then((function(e){return e.payload})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},y=p,T=n(15),D=n(32),I=T.a.img(f||(f=Object(s.a)(["\n    width: 100%;\n    object-fit:cover;\n    aspect-ratio:3/2;\n"]))),S=T.a.div(d||(d=Object(s.a)(["\n    position: relative;\n    border-radius:10px;\n    overflow:hidden;\n"]))),w=T.a.div(j||(j=Object(s.a)(["\n    position: absolute;\n    top:0;\n    bottom:0;\n    right:0;\n    left:0;\n    text-transform: uppercase;\n    display:flex;\n    align-items:center;\n    justify-content:center;\n    color: white;\n    font-size: 22px;\n    background-color: rgba(247,15,15,.7);\n    z-index:1;\n    font-weight: bold;\n"])));function k(e){var t=e.id,n=e.imageUrl,c=e.name,r=Object(D.a)(x),i=Object(O.a)(r,1)[0],s=Object(a.useState)(!1),u=Object(O.a)(s,2),l=u[0],f=u[1];return Object(a.useEffect)((function(){i.on("SERVER_EMIT_ROOM_WITH_STATUS_".concat(t),(function(e){0===e.gas||0===e.flame?f(!0):f(!1)}))}),[t,i,f]),Object(o.jsxs)("div",{children:[Object(o.jsx)(b.b,{to:"/room/"+t,children:Object(o.jsxs)(S,{children:[Object(o.jsx)(I,{src:n,alt:""}),l?Object(o.jsx)(w,{children:c}):null]})}),l?null:Object(o.jsx)("h5",{children:c})]})}function _(){var e=Object(a.useState)([]),t=Object(O.a)(e,2),n=t[0],c=t[1];Object(a.useEffect)((function(){var e=function(){var e=Object(v.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.fetchItems();case 3:t=e.sent,console.warn("rooms",t),c(t),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[c]);var r=n.map((function(e){return Object(o.jsx)("div",{className:"col-md-4 vitri mb-4",children:Object(o.jsx)(k,{id:e._id,imageUrl:e.imageUrl,name:e.name})},e._id)}));return Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("div",{className:"row",children:r})})}function H(){return Object(o.jsx)(_,{})}function N(e){var t=this,n=e.chartTimeInHour,a=e.onTimeChange,c=[{value:1,text:"1 hour"},{value:24,text:"1 day"},{value:168,text:"7 days"},{value:240,text:"10 days"}].map((function(e){var c=e.value===n?"btn-primary":"btn-light";return Object(o.jsx)("button",{onClick:a.bind(t,e.value),type:"button",className:"btn ".concat(c),children:e.text},e.value)}));return Object(o.jsx)("div",{children:Object(o.jsx)("div",{className:"btn-group",role:"group","aria-label":"",children:c})})}var E,L={strPad:function(e,t,n){return(e+="")?e.length>=t?e:n.repeat(t-e.length)+e:e}},M=T.a.span(E||(E=Object(s.a)(["\n    font-size:1.5rem;\n"])));function F(e){var t=Object(a.useState)(new Date),n=Object(O.a)(t,2),c=n[0],r=n[1];Object(a.useEffect)((function(){setInterval((function(){r(new Date)}),1e3)}),[r]);var i=L.strPad(c.getHours(),2,"0"),s=L.strPad(c.getMinutes(),2,"0"),u=L.strPad(c.getSeconds(),2,"0");return Object(o.jsxs)(M,{children:[i,":",s,":",u,'"']})}var C,R,B=n(6),P={fetchLastItemsByRoomId:function(e,t){return fetch("".concat(x,"/room-status/get-last-items-by-room-id/").concat(e,"?qty=").concat(t)).then((function(e){return e.json()})).then((function(e){return e.payload}))},fetchLastItemsAfterTimeByRoomId:function(e,t){return fetch("".concat(x,"/room-status/get-last-items-after-time/").concat(e,"?time=").concat(t)).then((function(e){return e.json()})).then((function(e){return e.payload}))}},A=n(17),U=n(4),z=n(2),V=n(3),W=function(){function e(t,n){Object(z.a)(this,e),this.time=t,this.items=n,this.timelineLength=this.getTimelineLength()}return Object(V.a)(e,[{key:"groupItemsByHour",value:function(){var e={};if(this.time>=24){var t,n=1,a=1;this.items.forEach((function(c){var r=new Date(c.date);r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0);var i=r.toISOString();e[i]?(0===c.gas&&(n=0),0===c.flame&&(a=0)):(t&&(console.log("update prev",t,n,a),e[t].gas=n,e[t].flame=a),e[i]={gas:n,flame:a},n=1,a=1,t=i)}))}return e}},{key:"genData",value:function(t){var n=this.genDefaultData(this.time),a=n.gasData,c=n.flameData,r=n.labels,i=this.getTimelineIndexes(t),s=0;if(this.time<24){var o,u=Object(U.a)(i);try{for(u.s();!(o=u.n()).done;){var l=o.value,f=t[s];a[l]=e.getStatus(f,"gas"),c[l]=e.getStatus(f,"flame"),r[l]=e.getLabel(f,this.time),s++}}catch(m){u.e(m)}finally{u.f()}}else{var d=this.groupItemsByHour();for(var j in d){var b=Object(A.a)(Object(A.a)({},d[j]),{},{date:j}),h=i[s];a[h]=e.getStatus(b,"gas"),c[h]=e.getStatus(b,"flame"),r[h]=e.getLabel(b,j),s++}}return{gasData:a,flameData:c,labels:r}}},{key:"genDefaultData",value:function(){return e.genDefaultData(this.time)}},{key:"getTimelineLength",value:function(){return e.getTimelineLength(this.time)}},{key:"diffTime",value:function(e){var t=this.chartTimeInHour>=24?6e4:36e5;return Math.ceil(Math.abs(new Date-e)/t)}},{key:"getTimelineIndex",value:function(e){return this.timelineLength-this.diffTime(new Date(e.date))}},{key:"getTimelineIndexes",value:function(e){var t=this;console.log("items length",e.length);var n={};e.forEach((function(e){var a=t.getTimelineIndex(e);n[a]=n[a]+1||1})),console.log("count",n);var a=Object.keys(n);return console.log("indexes",a),a}}],[{key:"getStatus",value:function(e,t){return 1===e[t]?0:1}},{key:"getLabel",value:function(e,t){var n=new Date(e.date),a=L.strPad(n.getMonth()+1,2,"0"),c=L.strPad(n.getDate(),2,"0"),r=L.strPad(n.getHours(),2,"0"),i=L.strPad(n.getMinutes(),2,"0");return t<24||24===t?"".concat(r,":").concat(i):"".concat(c,"/").concat(a," ").concat(r,":").concat(i)}},{key:"getFetchTime",value:function(e){var t=new Date;return t.setHours(t.getHours()-e),t.toISOString()}},{key:"genDefaultData",value:function(t){var n=this,a=e.getTimelineLength(t),c=Object(B.a)(Array(a)).map((function(e){return 0}));return{gasData:c.slice(0),flameData:c.slice(0),labels:c.slice(0).map((function(e,c){var r=new Date;return t<24?r.setMinutes(r.getMinutes()-(a-c)):r.setHours(r.getHours()-(a-c)),n.getLabel({date:r},t)}))}}},{key:"getTimelineLength",value:function(e){return e<24?60*e:e}}]),e}(),J=n(61),q={scales:{y:{beginAtZero:!0}},animation:{duration:0},responsive:!0,interaction:{mode:"index",intersect:!1},stacked:!1,plugins:{title:{display:!0,text:"Status Realtime Chart",font:{size:22,weight:"bold",lineHeight:1.2}}}},G=function(e){var t={labels:e.labels,datasets:[{label:"Gas",data:e.gasData,fill:!1,backgroundColor:"#dbdbdb",borderColor:"#8c8c8c"},{label:"Flame",data:e.flameData,fill:!1,backgroundColor:"#FFB1C1",borderColor:"#FF6384"}]};return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(J.a,{height:75,data:t,options:q})})};function Z(e){var t=e.item,n=e.chartTimeInHour,c=Object(D.a)(x),r=Object(O.a)(c,1)[0],i=W.genDefaultData(n),s=i.flameData,u=i.gasData,l=i.labels,f=Object(a.useState)(u),d=Object(O.a)(f,2),j=d[0],b=d[1],h=Object(a.useState)(s),m=Object(O.a)(h,2),p=m[0],y=m[1],T=Object(a.useState)(l),I=Object(O.a)(T,2),S=I[0],w=I[1];return Object(a.useEffect)((function(){r.off("SERVER_EMIT_ROOM_WITH_STATUS_".concat(t._id)),r.on("SERVER_EMIT_ROOM_WITH_STATUS_".concat(t._id),(function(e){console.log("socket"),b((function(t){var n=W.getStatus(e,["gas"]);return 0===t.length?[n]:[].concat(Object(B.a)(t.slice(1)),[n])})),y((function(t){var n=W.getStatus(e,["flame"]);return 0===t.length?[n]:[].concat(Object(B.a)(t.slice(1)),[n])})),w((function(t){var a=W.getLabel(e,n);return 0===t.length?[a]:[].concat(Object(B.a)(t.slice(1)),[a])}))}))}),[t._id,n,r]),Object(a.useEffect)((function(){var e=function(){var e=Object(v.a)(g.a.mark((function e(){var a,c,r,i,s,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.fetchLastItemsAfterTimeByRoomId(t._id,W.getFetchTime(n));case 3:a=(a=e.sent).reverse(),c=new W(n,a),r=c.genData(a),i=r.gasData,s=r.flameData,o=r.labels,b(i),y(s),w(o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();e()}),[t._id,n,b,w,y]),Object(o.jsx)("div",{className:"card",children:Object(o.jsx)("div",{className:"card-body",children:Object(o.jsx)(G,{gasData:j,flameData:p,labels:S})})})}var K,Q=T.a.div(C||(C=Object(s.a)(["\n    display:flex;\n    align-items:center;\n    justify-content:space-between;\n"]))),X=T.a.img(R||(R=Object(s.a)(["\n    aspect-ratio:3/2;\n    border-radius:10px;\n    max-width:100%;\n"])));function Y(){var e=Object(a.useState)(void 0),t=Object(O.a)(e,2),n=t[0],c=t[1],r=Object(h.f)().id,i=Object(a.useState)(1),s=Object(O.a)(i,2),u=s[0],l=s[1];return Object(a.useEffect)((function(){var e=function(){var e=Object(v.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.fetchItemById(r);case 2:t=e.sent,c(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[r,c]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("div",{className:"container",children:n?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"row mb-4",children:Object(o.jsx)("div",{className:"col-12",children:Object(o.jsxs)(Q,{children:[Object(o.jsx)("h1",{children:n.name}),Object(o.jsx)(F,{})]})})}),Object(o.jsxs)("div",{className:"row",children:[Object(o.jsx)("div",{className:"offset-lg-5 col-lg-2 mb-3",children:Object(o.jsx)(X,{src:n.imageUrl,alt:""})}),Object(o.jsxs)("div",{className:"col-12",children:[Object(o.jsx)("div",{children:Object(o.jsx)(N,{chartTimeInHour:u,onTimeChange:l})}),Object(o.jsx)(Z,{chartTimeInHour:u,item:n})]})]})]}):null})})}var $=T.a.div(K||(K=Object(s.a)(["\n    display:flex;\n    flex-direction:column;\n    min-height:100vh;\n"])));var ee=function(){return Object(o.jsx)(b.a,{children:Object(o.jsxs)($,{children:[Object(o.jsx)(l,{}),Object(o.jsx)("div",{className:"main",children:Object(o.jsxs)(h.c,{children:[Object(o.jsx)(h.a,{path:"/room/:id",children:Object(o.jsx)(Y,{})}),Object(o.jsx)(h.a,{path:"/",exact:!0,children:Object(o.jsx)(H,{})})]})}),Object(o.jsx)(u,{})]})})},te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,103)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(o.jsx)(c.a.StrictMode,{children:Object(o.jsx)(ee,{})}),document.getElementById("root")),te()},66:function(e,t,n){},67:function(e,t,n){},95:function(e,t){}},[[102,1,2]]]);
//# sourceMappingURL=main.fcb4c47c.chunk.js.map